<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Lokesh Mano • 26-Jan-2022" />


<title>RShiny Lab: Part II</title>

<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<link id="font-awesome-1-attachment" rel="attachment" href="site_libs/font-awesome-5.1.0/fonts/fontawesome-webfont.ttf"/>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>





<link rel="stylesheet" href="assets/lab.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
#TOC {
  display: none !important;
}
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"><img src="assets/logo.svg" id="logo" style="height:22px;margin:0;"/></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="home_schedule.html">Schedule</a>
</li>
<li>
  <a href="home_content.html">Content</a>
</li>
<li>
  <a href="home_precourse.html">Precourse</a>
</li>
<li>
  <a href="home_info.html">Info</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">RShiny Lab: Part II</h1>
<h3 class="subtitle">Workshop on Data Visualization in R</h3>
<h4 class="author"><b>Lokesh Mano</b> • 26-Jan-2022</h4>

</div>


<!-- rmd lab header -->
<p><br></p>
<!-- ------------ Only edit title, subtitle & author above this ------------ -->
<div id="reactivity" class="section level1">
<h1><span class="header-section-number">1</span> Reactivity</h1>
<p>We will here first look into the example of what the automatic reactivity of Rshiny looks like. The reactive functions like <code>renderPlot()</code> and <code>renderPrint()</code> are always looking for any changes in the input values and are updated quickly! Although this is super handy for any app, sometimes this can lead to unwanted confusion. Like, take the R function <code>rnorm()</code>, this function basically spits out random numbers. If you use this function in an app, everytime this function is called, it will output different random number sets. This can cause problems like in the example below:</p>
<p><i class="fas fa-clipboard-list"></i> Task   Try to change the slider input values and check if the <code>summary</code> and <code>hist</code> match with each other?</p>
<pre class="r"><code>ui &lt;- fluidPage(
  sliderInput(inputId = &quot;num&quot;, 
    label = &quot;Choose a number&quot;, 
    value = 25, min = 1, max = 100),
  plotOutput(&quot;hist&quot;),
  verbatimTextOutput(&quot;stats&quot;)
)

server &lt;- function(input, output) {
  output$hist &lt;- renderPlot({
    hist(rnorm(input$num))
  })
  output$stats &lt;- renderPrint({
    summary(rnorm(input$num))
  })
}

shinyApp(ui = ui, server = server)</code></pre>
<details>
<p><summary>plot</summary></p>
<p><img src="lab_shiny2_files/figure-html/unnamed-chunk-4-1.png" width="672" style="display: block; margin: auto auto auto 0;" /></p>
</details>
<p>So, in order to make it consistent, we have to use the <code>rnorm()</code> only once and save it as a <code>reactive function</code> and then apply it to both the <code>hist()</code> and <code>summary()</code>. We do this by using <code>reactive()</code> function to store it as a variable. See the example below:</p>
<pre class="r"><code>ui &lt;- fluidPage(
  sliderInput(inputId = &quot;num&quot;, 
    label = &quot;Choose a number&quot;, 
    value = 25, min = 1, max = 100),
  plotOutput(&quot;hist&quot;),
  verbatimTextOutput(&quot;stats&quot;)
)

server &lt;- function(input, output) {
  
  data &lt;- reactive({
    rnorm(input$num)
  })
  
  output$hist &lt;- renderPlot({
    hist(data())
  })
  output$stats &lt;- renderPrint({
    summary(data())
  })
}

shinyApp(ui = ui, server = server)</code></pre>
<details>
<p><summary>plot</summary></p>
<p><img src="lab_shiny2_files/figure-html/unnamed-chunk-5-1.png" width="672" style="display: block; margin: auto auto auto 0;" /></p>
</details>
<p><i class="fas fa-exclamation-circle"></i> Note   As the <code>data</code> variable we have in the example above is a reactive function, you have to remember to use <code>()</code> whenever you call that particular variable.</p>
</div>
<div id="isolating-reactivity" class="section level1">
<h1><span class="header-section-number">2</span> Isolating reactivity</h1>
<p>In the same manner as above, sometimes you will notice that the Rshiny’s reactivity can be very quick! Take the below example and try to type in the title of the histogram slowly. You will notice that the histogram will keep changing as you type, because the <code>rnorm()</code> gets updated constantly as you type!</p>
<pre class="r"><code>ui &lt;- fluidPage(
  sliderInput(inputId = &quot;num&quot;, 
    label = &quot;Choose a number&quot;, 
    value = 25, min = 1, max = 100),
  textInput(inputId = &quot;title&quot;, 
    label = &quot;Write a title&quot;,
    value = &quot;Histogram of Random Normal Values&quot;),
  plotOutput(&quot;hist&quot;)
)

server &lt;- function(input, output) {
  output$hist &lt;- renderPlot({
    hist(rnorm(input$num), main = input$title)
  })
}

shinyApp(ui = ui, server = server)</code></pre>
<details>
<p><summary>plot</summary></p>
<p><img src="lab_shiny2_files/figure-html/unnamed-chunk-6-1.png" width="672" style="display: block; margin: auto auto auto 0;" /></p>
</details>
<p>By using the <code>isolate()</code> function, we can make certain UI input components to not react for changes! This means you can change/decide the title of the plot first and then you can change the slider in the example above to decide on the histogram you want for a particular value!</p>
<pre class="r"><code>ui &lt;- fluidPage(
  sliderInput(inputId = &quot;num&quot;, 
    label = &quot;Choose a number&quot;, 
    value = 25, min = 1, max = 100),
  textInput(inputId = &quot;title&quot;, 
    label = &quot;Write a title&quot;,
    value = &quot;Histogram of Random Normal Values&quot;),
  plotOutput(&quot;hist&quot;)
)

server &lt;- function(input, output) {
  output$hist &lt;- renderPlot({
    hist(rnorm(input$num), main = isolate(input$title))
  })
}

shinyApp(ui = ui, server = server)</code></pre>
<details>
<p><summary>plot</summary></p>
<p><img src="lab_shiny2_files/figure-html/unnamed-chunk-7-1.png" width="672" style="display: block; margin: auto auto auto 0;" /></p>
</details>
</div>
<div id="eventreactive" class="section level1">
<h1><span class="header-section-number">3</span> eventReactive()</h1>
<p>This is similar to the <code>observeEvent()</code>, where it is used to send message like logs when you click on a button.
In the following example, we will see how to use <code>eventReactive()</code> with an action button and when you press it, the random numbers are only generated then. You can think of it as an <code>update</code> button. Let us look at the example below:</p>
<pre class="r"><code>ui &lt;- fluidPage(
  sliderInput(inputId = &quot;num&quot;, 
    label = &quot;Choose a number&quot;, 
    value = 25, min = 1, max = 100),
  textInput(inputId = &quot;title&quot;, 
    label = &quot;Write a title&quot;,
    value = &quot;Histogram of Random Normal Values&quot;),
  plotOutput(&quot;hist&quot;),
  actionButton(inputId = &quot;click&quot;, label = &quot;Update&quot;)
)

server &lt;- function(input, output) {
  randomVals &lt;- eventReactive(input$click, {
    rnorm(input$num)
  })
  output$hist &lt;- renderPlot({
    hist(randomVals(), main = input$title)
  })
}

shinyApp(ui = ui, server = server)</code></pre>
<details>
<p><summary>plot</summary></p>
<p><img src="lab_shiny2_files/figure-html/unnamed-chunk-8-1.png" width="672" style="display: block; margin: auto auto auto 0;" /></p>
</details>
</div>
<div id="updating-widgets" class="section level1">
<h1><span class="header-section-number">4</span> Updating widgets</h1>
<p>Widgets can be updated with new values dynamically. <code>observe()</code> and <code>observeEvent()</code> functions can monitor the values of interest and update relevant widgets.</p>
<pre class="r"><code>shinyApp(
ui=fluidPage(
  selectInput(&quot;data_input&quot;,label=&quot;Select data&quot;,choices=c(&quot;mtcars&quot;,&quot;faithful&quot;,&quot;iris&quot;)),
  selectInput(&quot;header_input&quot;,label=&quot;Select column name&quot;,choices=NULL),
  plotOutput(&quot;plot_output&quot;,width=&quot;400px&quot;)
),
server=function(input,output,session) {
  getdata &lt;- reactive({ get(input$data_input, &#39;package:datasets&#39;) })
  
  observe({
    updateSelectInput(session,&quot;header_input&quot;,label=&quot;Select column name&quot;,choices=colnames(getdata()))
  })
  
  output$plot_output &lt;- renderPlot({
    #shiny::req(input$header_input)
    #validate(need(input$header_input %in% colnames(getdata()),message=&quot;Incorrect column name.&quot;))
    hist(getdata()[, input$header_input],xlab=input$header_input,main=input$data_input)
  })
},
options=list(height=600))</code></pre>
<details>
<p><summary>plot</summary></p>
<p><img src="lab_shiny2_files/figure-html/unnamed-chunk-9-1.png" width="672" style="display: block; margin: auto auto auto 0;" /></p>
</details>
<p>In this example, the user selects a dataset and a column from the selected dataset to be plotted as a histogram. The column name selection widget must automatically update it’s choices depending on the selected dataset. This achieved using <code>observe()</code> where the <code>updateSelectInput()</code> function updates the selection choices. Notice that a third option <code>session</code> is in use in the server function. ie; <code>server=function(input,output,session)</code>. And <code>session</code> is also the first argument in <code>updateSelectInput()</code>. Session keeps track of values in the current session.</p>
<p>When changing the datasets, we can see that there is a short red error message. This is because, after we have selected a new dataset, the old column name from the previous dataset is searched for in the new dataset. This occurs for a short time and causes the error. This can be fixed using careful error handling. We will discuss this in another section.</p>
</div>
<div id="error-validation" class="section level1">
<h1><span class="header-section-number">5</span> Error validation</h1>
<p>Shiny returns an error when a variable is NULL, NA or empty. This is similar to normal R operation. The errors show up as bright red text. By using careful error handling, we can print more informative and less distracting error messages. We also have the option of hiding error messages.</p>
<pre class="r"><code>shinyApp(
ui=fluidPage(
  selectInput(&quot;data_input&quot;,label=&quot;Select data&quot;,
              choices=c(&quot;&quot;,&quot;mtcars&quot;,&quot;faithful&quot;,&quot;iris&quot;)),
  tableOutput(&quot;table_output&quot;)
),
server=function(input, output) {
  getdata &lt;- reactive({ get(input$data_input,&#39;package:datasets&#39;) })
  output$table_output &lt;- renderTable({head(getdata())})
},
options=list(height=&quot;350px&quot;))</code></pre>
<details>
<p><summary>plot</summary></p>
<p><img src="lab_shiny2_files/figure-html/unnamed-chunk-10-1.png" width="672" style="display: block; margin: auto auto auto 0;" /></p>
</details>
<p>In this example, we have a list of datasets to select which is then printed as a table. The first and default option is an empty string which cannot be printed as a table and therefore returns an error.</p>
<p>We can add an extra line to the above app so that the selected string is validated before running downstream commands in the <code>getdata({})</code> reactive function. The function <code>validate()</code> is used to validate inputs. <code>validate()</code> can be used with <code>need()</code> function or a custom function.</p>
<p>Below we use the <code>need()</code> function to check the input. It checks if the input is NULL, NA or an empty string and returns a specified message if TRUE. <code>try()</code> is optional and is used to catch any other unexpected errors.</p>
<pre class="r"><code>shinyApp(
ui=fluidPage(
  selectInput(&quot;data_input&quot;,label=&quot;Select data&quot;,
              choices=c(&quot;&quot;,&quot;mtcars&quot;,&quot;faithful&quot;,&quot;iris&quot;)),
  tableOutput(&quot;table_output&quot;)
),
server=function(input, output) {
  
  getdata &lt;- reactive({
    validate(need(try(input$data_input),&quot;Please select a data set&quot;))
    get(input$data_input,&#39;package:datasets&#39;)
  })
  
  output$table_output &lt;- renderTable({head(getdata())})
},
options=list(height=&quot;350px&quot;))</code></pre>
<details>
<p><summary>plot</summary></p>
<p><img src="lab_shiny2_files/figure-html/unnamed-chunk-11-1.png" width="672" style="display: block; margin: auto auto auto 0;" /></p>
</details>
<p>Now we see an informative grey message (less scary) asking the user to select a dataset.</p>
<p>We can use a custom function instead of using <code>need()</code>. Below, we have created a function called <code>valfun()</code> that checks if the input is NULL, NA or an empty string. This is then used in <code>validate()</code>.</p>
<pre class="r"><code>valfn &lt;- function(x) if(is.null(x) | is.na(x) | x==&quot;&quot;) return(&quot;Input data is incorrect.&quot;)
shinyApp(
ui=fluidPage(
  selectInput(&quot;data_input&quot;,label=&quot;Select data&quot;,
              choices=c(&quot;&quot;,&quot;mtcars&quot;,&quot;faithful&quot;,&quot;iris&quot;)),
  tableOutput(&quot;table_output&quot;)
),
server=function(input, output) {
  
  getdata &lt;- reactive({
    validate(valfn(try(input$data_input)))
    get(input$data_input,&#39;package:datasets&#39;)
  })
  
  output$table_output &lt;- renderTable({head(getdata())})
},
options=list(height=&quot;350px&quot;))</code></pre>
<details>
<p><summary>plot</summary></p>
<p><img src="lab_shiny2_files/figure-html/unnamed-chunk-12-1.png" width="672" style="display: block; margin: auto auto auto 0;" /></p>
</details>
<p>The last option is to simple hide the error. This may be used in situations where there is no input needed from the user. We use <code>req()</code> to check if the input is valid, else stop execution there till the condition becomes true.</p>
<pre class="r"><code>shinyApp(
ui=fluidPage(
  selectInput(&quot;data_input&quot;,label=&quot;Select data&quot;,
              choices=c(&quot;&quot;,&quot;mtcars&quot;,&quot;faithful&quot;,&quot;iris&quot;)),
  tableOutput(&quot;table_output&quot;)
),
server=function(input, output) {
  
  getdata &lt;- reactive({
    shiny::req(try(input$data_input))
    get(input$data_input,&#39;package:datasets&#39;)
  })
  
  output$table_output &lt;- renderTable({head(getdata())})
},
options=list(height=&quot;350px&quot;))</code></pre>
<details>
<p><summary>plot</summary></p>
<p><img src="lab_shiny2_files/figure-html/unnamed-chunk-13-1.png" width="672" style="display: block; margin: auto auto auto 0;" /></p>
</details>
<p>As expected there is no error or any message at all. This is not always the best to use this option as we need the user to do something. An informative message may be better than nothing.</p>
<p>Finally, instead of printing messages about the error or hiding the error, we can try to resolve the errors from the previous section in a more robust manner. <code>shiny::req(input$header_input)</code> is added to ensure that a valid column name string is available before running any of the <code>renderPlot()</code> commands. Second, we add <code>validate(need(input$header_input %in% colnames(getdata()),message="Incorrect column name."))</code> to ensure that the column name is actually a column in the currently selected dataset.</p>
<pre class="r"><code>shinyApp(
ui=fluidPage(
  selectInput(&quot;data_input&quot;,label=&quot;Select data&quot;,choices=c(&quot;mtcars&quot;,&quot;faithful&quot;,&quot;iris&quot;)),
  selectInput(&quot;header_input&quot;,label=&quot;Select column name&quot;,choices=NULL),
  plotOutput(&quot;plot_output&quot;,width=&quot;400px&quot;)
),
server=function(input,output,session) {
  getdata &lt;- reactive({ get(input$data_input, &#39;package:datasets&#39;) })
  
  observe({
    updateSelectInput(session,&quot;header_input&quot;,label=&quot;Select column name&quot;,choices=colnames(getdata()))
  })
  
  output$plot_output &lt;- renderPlot({
    shiny::req(input$header_input)
    validate(need(input$header_input %in% colnames(getdata()),message=&quot;Incorrect column name.&quot;))
    hist(getdata()[, input$header_input],xlab=input$header_input,main=input$data_input)
  })
},
options=list(height=600))</code></pre>
<details>
<p><summary>plot</summary></p>
<p><img src="lab_shiny2_files/figure-html/unnamed-chunk-14-1.png" width="672" style="display: block; margin: auto auto auto 0;" /></p>
</details>
<p>Now, we do not see any error messages. Note that shiny apps on shinyapps.io do not display the complete regular R error message for security reasons. It returns a generic error message in the app. One needs to inspect the error logs to view the actual error message.</p>
</div>
<div id="download-data" class="section level1">
<h1><span class="header-section-number">6</span> Download • Data</h1>
<p>It is often desirable to let the user down data tables and plots as images. This is done using <code>downloadHandler()</code>.</p>
<p>In the example below, we are downloading a table as a csv text file. We define a button that accepts the action input from the user. The <code>downloadHandler()</code> function has the file name argument, and the content argument where we specify the <code>write.csv()</code> command. Note that this example needs to be opened in a browser and may not in the RStudio preview. In the RStudio preview, click on <strong>Open in Browser</strong>.</p>
<pre class="r"><code>shinyApp(
  ui=fluidPage(
    selectInput(&quot;data_input&quot;,label=&quot;Select data&quot;,
                choices=c(&quot;mtcars&quot;,&quot;faithful&quot;,&quot;iris&quot;)),
    textOutput(&quot;text_output&quot;),
    downloadButton(&quot;button_download&quot;,&quot;Download&quot;)
  ),
  server=function(input, output) {
    
    getdata &lt;- reactive({ get(input$data_input, &#39;package:datasets&#39;) })
    output$text_output &lt;- renderText(paste0(&quot;Selected dataset: &quot;,input$data_input))
    
    output$button_download &lt;- downloadHandler(
      filename = function() {
        paste0(input$data_input,&quot;.csv&quot;)
      },
      content = function(file) {
        write.csv(getdata(),file,row.names=FALSE,quote=F)
      })
  },
  options=list(height=&quot;200px&quot;)
)</code></pre>
<details>
<p><summary>plot</summary></p>
<p><img src="lab_shiny2_files/figure-html/unnamed-chunk-15-1.png" width="672" style="display: block; margin: auto auto auto 0;" /></p>
</details>
</div>
<div id="download-plot" class="section level1">
<h1><span class="header-section-number">7</span> Download • Plot</h1>
<p>In this next example, we are downloading a plot. In the content part of <code>downloadHandler()</code>, we specify commands to export a png image. Note that this example needs to be opened in a browser and may not in the RStudio preview. In the RStudio preview, click on <strong>Open in Browser</strong>.</p>
<pre class="r"><code>shinyApp(
  ui=fluidPage(
    selectInput(&quot;data_input&quot;,label=&quot;Select data&quot;,
                choices=c(&quot;mtcars&quot;,&quot;faithful&quot;,&quot;iris&quot;)),
    textOutput(&quot;text_output&quot;),
    plotOutput(&quot;plot_output&quot;,height=&quot;300px&quot;,width=&quot;300px&quot;),
    downloadButton(&quot;button_download&quot;,&quot;Download&quot;)
  ),
  server=function(input, output) {
    
    getdata &lt;- reactive({ get(input$data_input, &#39;package:datasets&#39;) })
    output$text_output &lt;- renderText(paste0(&quot;Selected dataset: &quot;,input$data_input))
    
    output$plot_output &lt;- renderPlot({hist(getdata()[,1])})
  
  output$button_download &lt;- downloadHandler(
    filename = function() {
      paste0(input$data_input,&quot;.png&quot;)
    },
    content = function(file) {
      png(file)
      hist(getdata()[, 1])
      dev.off()
    })
  },
  options=list(height=&quot;500px&quot;)
)</code></pre>
<details>
<p><summary>plot</summary></p>
<p><img src="lab_shiny2_files/figure-html/unnamed-chunk-16-1.png" width="672" style="display: block; margin: auto auto auto 0;" /></p>
</details>
</div>
<div id="shiny-in-rmarkdown" class="section level1">
<h1><span class="header-section-number">8</span> Shiny in Rmarkdown</h1>
<p>Shiny interactive widgets can be embedded into Rmarkdown documents. These documents need to be live and can handle interactivity. The important addition is the line <code>runtime: shiny</code> to the YAML matter. Here is an example:</p>
<details>
<p><summary>output</summary></p>
<pre><code>---
runtime: shiny
output: html_document
---

```{r}
library(shiny)
```

This is a standard RMarkdown document. Here is some code:

```{r}
head(iris)
```

```{r}
plot(iris$Sepal.Length,iris$Petal.Width)
```

But, here is an interactive shiny widget.

```{r}
sliderInput(&quot;in_breaks&quot;,label=&quot;Breaks:&quot;,min=5,max=50,value=5,step=5)
```

```{r}
renderPlot({
hist(iris$Sepal.Length,breaks=input$in_breaks)
})
```</code></pre>
</details>
<p>This code can be copied to a new file in RStudio and saved as, for example, <strong>shiny.Rmd</strong>. Then click ‘Knit’. Alternatively, you can run <code>rmarkdown::run("shiny.Rmd")</code>.</p>
</div>
<div id="session-info" class="section level1">
<h1><span class="header-section-number">9</span> Session info</h1>
<pre class="r"><code>sessionInfo()</code></pre>
<pre><code>## R version 4.0.0 (2020-04-24)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Ubuntu 18.04.6 LTS
## 
## Matrix products: default
## BLAS:   /usr/lib/x86_64-linux-gnu/openblas/libblas.so.3
## LAPACK: /usr/lib/x86_64-linux-gnu/libopenblasp-r0.2.20.so
## 
## locale:
##  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       
##  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   
##  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          
## [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] shiny_1.7.1            ggimage_0.3.0          treeio_1.18.1         
##  [4] ggtree_3.2.1           pheatmap_1.0.12        swemaps_1.0           
##  [7] mapdata_2.3.0          maps_3.4.0             ggpubr_0.4.0          
## [10] cowplot_1.1.1          ggthemes_4.2.4         scales_1.1.1          
## [13] ggrepel_0.9.1          wesanderson_0.3.6      forcats_0.5.1         
## [16] stringr_1.4.0          purrr_0.3.4            readr_2.1.1           
## [19] tidyr_1.1.4            tibble_3.1.6           tidyverse_1.3.1       
## [22] reshape2_1.4.4         ggplot2_3.3.5          formattable_0.2.1     
## [25] kableExtra_1.3.4       dplyr_1.0.7            lubridate_1.8.0       
## [28] leaflet_2.0.4.1        yaml_2.2.1             fontawesome_0.2.2.9000
## [31] captioner_2.2.3        bookdown_0.24          knitr_1.37            
## 
## loaded via a namespace (and not attached):
##  [1] colorspace_2.0-2        ggsignif_0.6.3          ellipsis_0.3.2         
##  [4] fs_1.5.2                aplot_0.1.2             rstudioapi_0.13        
##  [7] farver_2.1.0            fansi_1.0.2             xml2_1.3.3             
## [10] splines_4.0.0           cachem_1.0.6            jsonlite_1.7.3         
## [13] broom_0.7.11            dbplyr_2.1.1            compiler_4.0.0         
## [16] httr_1.4.2              backports_1.4.1         assertthat_0.2.1       
## [19] Matrix_1.2-18           fastmap_1.1.0           lazyeval_0.2.2         
## [22] cli_3.1.0               later_1.3.0             leaflet.providers_1.9.0
## [25] htmltools_0.5.2         tools_4.0.0             gtable_0.3.0           
## [28] glue_1.6.0              Rcpp_1.0.8              carData_3.0-5          
## [31] cellranger_1.1.0        jquerylib_0.1.4         vctrs_0.3.8            
## [34] ape_5.6-1               svglite_2.0.0           nlme_3.1-147           
## [37] crosstalk_1.2.0         xfun_0.29               ps_1.6.0               
## [40] rvest_1.0.2             mime_0.12               lifecycle_1.0.1        
## [43] rstatix_0.7.0           promises_1.2.0.1        hms_1.1.1              
## [46] parallel_4.0.0          RColorBrewer_1.1-2      curl_4.3.2             
## [49] gridExtra_2.3           ggfun_0.0.4             yulab.utils_0.0.4      
## [52] sass_0.4.0              stringi_1.7.6           highr_0.9              
## [55] tidytree_0.3.7          rlang_0.4.12            pkgconfig_2.0.3        
## [58] systemfonts_1.0.3       evaluate_0.14           lattice_0.20-41        
## [61] patchwork_1.1.1         htmlwidgets_1.5.4       labeling_0.4.2         
## [64] processx_3.5.2          tidyselect_1.1.1        plyr_1.8.6             
## [67] magrittr_2.0.1          R6_2.5.1                magick_2.7.3           
## [70] generics_0.1.1          DBI_1.1.2               pillar_1.6.4           
## [73] haven_2.4.3             withr_2.4.3             mgcv_1.8-31            
## [76] abind_1.4-5             modelr_0.1.8            crayon_1.4.2           
## [79] car_3.0-12              utf8_1.2.2              tzdb_0.2.0             
## [82] rmarkdown_2.11          grid_4.0.0              readxl_1.3.1           
## [85] callr_3.7.0             reprex_2.0.1            digest_0.6.29          
## [88] webshot_0.5.2           xtable_1.8-4            httpuv_1.6.5           
## [91] gridGraphics_0.5-1      munsell_0.5.0           viridisLite_0.4.0      
## [94] ggplotify_0.1.0         bslib_0.3.1</code></pre>
<hr />
</div>

<footer class="footer">
<div class="container container-footer">
<div class="row">
<div class="col-sm-8" style="text-align:left;vertical-align:middle;">
<p style="color:#bdbdbd;">
<b>2022</b> • NBIS • SciLifeLab
</p>
</div>
<div class="col-sm-4" style="text-align:right;vertical-align:middle;">
<p style="color:#bdbdbd;">
<span> <span class="footericon" style="padding-right:4px; padding-left:4px"> <a href="https://nbis.se/"><svg aria-hidden="true" role="img" viewBox="0 0 496 512" style="height:1em;width:0.97em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#bdbdbd;overflow:visible;position:relative;"><path d="M248 8C111.03 8 0 119.03 0 256s111.03 248 248 248 248-111.03 248-248S384.97 8 248 8zm82.29 357.6c-3.9 3.88-7.99 7.95-11.31 11.28-2.99 3-5.1 6.7-6.17 10.71-1.51 5.66-2.73 11.38-4.77 16.87l-17.39 46.85c-13.76 3-28 4.69-42.65 4.69v-27.38c1.69-12.62-7.64-36.26-22.63-51.25-6-6-9.37-14.14-9.37-22.63v-32.01c0-11.64-6.27-22.34-16.46-27.97-14.37-7.95-34.81-19.06-48.81-26.11-11.48-5.78-22.1-13.14-31.65-21.75l-.8-.72a114.792 114.792 0 0 1-18.06-20.74c-9.38-13.77-24.66-36.42-34.59-51.14 20.47-45.5 57.36-82.04 103.2-101.89l24.01 12.01C203.48 89.74 216 82.01 216 70.11v-11.3c7.99-1.29 16.12-2.11 24.39-2.42l28.3 28.3c6.25 6.25 6.25 16.38 0 22.63L264 112l-10.34 10.34c-3.12 3.12-3.12 8.19 0 11.31l4.69 4.69c3.12 3.12 3.12 8.19 0 11.31l-8 8a8.008 8.008 0 0 1-5.66 2.34h-8.99c-2.08 0-4.08.81-5.58 2.27l-9.92 9.65a8.008 8.008 0 0 0-1.58 9.31l15.59 31.19c2.66 5.32-1.21 11.58-7.15 11.58h-5.64c-1.93 0-3.79-.7-5.24-1.96l-9.28-8.06a16.017 16.017 0 0 0-15.55-3.1l-31.17 10.39a11.95 11.95 0 0 0-8.17 11.34c0 4.53 2.56 8.66 6.61 10.69l11.08 5.54c9.41 4.71 19.79 7.16 30.31 7.16s22.59 27.29 32 32h66.75c8.49 0 16.62 3.37 22.63 9.37l13.69 13.69a30.503 30.503 0 0 1 8.93 21.57 46.536 46.536 0 0 1-13.72 32.98zM417 274.25c-5.79-1.45-10.84-5-14.15-9.97l-17.98-26.97a23.97 23.97 0 0 1 0-26.62l19.59-29.38c2.32-3.47 5.5-6.29 9.24-8.15l12.98-6.49C440.2 193.59 448 223.87 448 256c0 8.67-.74 17.16-1.82 25.54L417 274.25z"></path></svg></a> </span> <span class="footericon" style="padding-right:4px; padding-left:4px"> <a href="https://twitter.com/NBISwe"><svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#bdbdbd;overflow:visible;position:relative;"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></a> </span> <span class="footericon" style="padding-left:4px"> <a href="https://www.linkedin.com/company/nbisweden/"><svg aria-hidden="true" role="img" viewBox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#bdbdbd;overflow:visible;position:relative;"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a> </span> </span>
</p>
</div>
</div>
</div>
</footer>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
